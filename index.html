<!DOCTYPE html>
<html>
<head>
  <title>.bitter</title>
  <style>* {margin:0; padding:0}</style>
</head>
<body>
<div id="result"></div>
<script>
function cleanJSONString(jsonString) {
    return jsonString.replace(/â†µ/g, "") // remove newline characters
                     .replace(/'/g, '"') // replace single quotes with double quotes
                     .trim();
}

async function fetchData() {
    const url1 = "https://web3.inscribe.today/https://unisat.io/brc20-api-v2/inscriptions/category/text/search/v2?name=p%22%3A%22.bitter&limit=100&start=0";
    const url2 = "https://web3.inscribe.today/https://unisat.io/brc20-api-v2/inscriptions/category/text/search/v2?name=p%22%3A%20%22.bitter&limit=100&start=0";

    try {
        const response1 = await fetch(url1);
        const response2 = await fetch(url2);
        const data1 = await response1.json();
        const data2 = await response2.json();

        let combinedData = [...data1.data.detail, ...data2.data.detail];
        combinedData.sort((a, b) => a.timestamp - b.timestamp);

        combinedData = combinedData.map(item => {
            const cleanedJSON = cleanJSONString(item.inscriptionName);
            try {
                const inscriptionNameJson = JSON.parse(cleanedJSON);
                const { username, ordinal } = inscriptionNameJson;
                return {
                    username,
                    ordinal,
                    timestamp: item.timestamp
                };
            } catch (error) {
                console.log('Invalid JSON format in inscription:', cleanedJSON);
                return null; // or return default values for username, ordinal and timestamp if desired
            }
        }).filter(item => item);  // Filter out null values

        return combinedData;
    } catch (error) {
        console.error('Error:', error);
    }
}

fetchData().then(data => {
    const resultDiv = document.getElementById('result');
    data.forEach(item => {
        const itemDiv = document.createElement('div');
        itemDiv.textContent = `Username: ${item.username}, Ordinal: ${item.ordinal}, Timestamp: ${item.timestamp}`;
        resultDiv.appendChild(itemDiv);
    });
});
</script>
</body>
</html>
